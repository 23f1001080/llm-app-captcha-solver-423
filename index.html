<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple CAPTCHA Solver</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Multiple CAPTCHA Solver</h1>
        <div id="captcha-container"></div>
    </div>
    <script>
        // Function to extract URL parameters
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Function to call Gemini API and solve CAPTCHA
        async function solveCaptcha(imageUrl, index) {
            const API_KEY = ''; // Replace with your actual Gemini API key
            const MODEL_NAME = "gemini-1.5-pro-vision-001";
            const URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`
            const data = {
                contents: [{
                    parts: [{
                        inline_data: {
                            mime_type: "image/jpeg",
                            data: imageUrl
                        }
                    }, {
                        text: "What letters and numbers are shown in the image?"
                    }]
                }]
            };

            try {
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result && result.candidates && result.candidates[0] && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts[0] && result.candidates[0].content.parts[0].text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Unexpected API response format:", result);
                    return "Error: Could not parse API response.";
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Error: Could not call Gemini API.";
            } finally {
                document.getElementById(`loading-indicator-${index}`).style.display = 'none';
            }
        }

        // Main function to handle multiple CAPTCHAs
        async function main() {
            const captchaContainer = document.getElementById('captcha-container');
            let i = 1;
            let imageUrl;
            while ((imageUrl = getParameterByName(`url${i}`))) {
                const index = i;
                const captchaDiv = document.createElement('div');
                captchaDiv.classList.add('captcha-item');

                const imageElement = document.createElement('img');
                imageElement.src = imageUrl;
                imageElement.alt = `CAPTCHA Image ${index}`;
                imageElement.id = `captcha-image-${index}`;

                const loadingIndicator = document.createElement('div');
                loadingIndicator.id = `loading-indicator-${index}`;
                loadingIndicator.classList.add('loading-indicator');
                loadingIndicator.textContent = 'Loading...';

                const resultElement = document.createElement('p');
                resultElement.id = `captcha-text-${index}`;
                resultElement.innerHTML = `CAPTCHA ${index}: <span id="captcha-result-${index}"></span>`;

                captchaDiv.appendChild(imageElement);
                captchaDiv.appendChild(loadingIndicator);
                captchaDiv.appendChild(resultElement);
                captchaContainer.appendChild(captchaDiv);

                imageElement.onload = async () => {
                    document.getElementById(`loading-indicator-${index}`).style.display = 'flex';
                    try {
                        const solvedText = await Promise.race([
                            solveCaptcha(imageUrl, index),
                            new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 15000))
                        ]);
                        document.getElementById(`captcha-result-${index}`).textContent = solvedText;
                    } catch (error) {
                        console.error(`Error solving CAPTCHA ${index}:`, error);
                        document.getElementById(`captcha-result-${index}`).textContent = `Error: ${error.message}`;
                    } finally {
                        document.getElementById(`loading-indicator-${index}`).style.display = 'none';
                    }
                };

                imageElement.onerror = () => {
                    document.getElementById(`captcha-result-${index}`).textContent = "Error: Could not load image.";
                    document.getElementById(`loading-indicator-${index}`).style.display = 'none';
                };

                i++;
            }

            if (i === 1) {
                const noImagesMessage = document.createElement('p');
                noImagesMessage.textContent = "No CAPTCHA image URLs provided.";
                captchaContainer.appendChild(noImagesMessage);
            }
        }

        // Call the main function when the page loads
        window.onload = main;
    </script>
</body>
</html>